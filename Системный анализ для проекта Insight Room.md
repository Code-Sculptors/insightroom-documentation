## Диаграммы состояний (State Diagram)

###### 1. Состояние пользователя
```mermaid

stateDiagram-v2
    [*] --> Гость
    Гость --> Зарегистрирован : Регистрация
    Гость --> Авторизован : Вход
    
    state Зарегистрирован {
        [*] --> Ожидает_активации
        Ожидает_активации --> Активен : Подтверждение email
    }
    
    Авторизован --> В_конференции : Присоединиться
    Авторизован --> [*] : Выход
    
    state В_конференции {
        [*] --> Активный
        Активный --> Приглушенный : Выключить микрофон
        Приглушенный --> Активный : Включить микрофон
        Активный --> Демонстрация : Показать экран
        Демонстрация --> Активный : Остановить демонстрацию
    }
    
    В_конференции --> Авторизован : Покинуть конференцию
```
##### 2. Состояние конференции
```mermaid
stateDiagram-v2

    [*] --> Неактивная
    Неактивная --> Активная : Организатор начинает
    Активная --> Записывается : Начата запись
    Записывается --> Активная : Остановлена запись
    
    state Активная {
        [*] --> Ожидание
        Ожидание --> Идет_встреча : Участники присоединились
        Идет_встреча --> Ожидание : Все участники вышли
    }
    
    Активная --> Завершенная : Организатор завершает
    Записывается --> Завершенная : Организатор завершает
    Завершенная --> [*]
```

## Use Case диаграммы 
  
##### 1. Основные возможности

```mermaid
graph LR
    A((Гость)) --> B[Зарегистрироваться]
    A --> C[Войти в систему]
    D((Пользователь)) --> E[Создать конференцию]
    D --> F[Присоединиться к конференции]
    D --> G[Выйти из системы]
    D --> H[Добавить контакт]
    D --> I[Удалить контакт]
    
    style B fill:#feeeff
    style C fill:#feeeff
    style E fill:#f0f8ff
    style F fill:#f0f8ff
    style G fill:#f0f8ff
    style H fill:#f0f8ff
    style I fill:#f0f8ff
```

##### 2. Возможности в конференции

```mermaid
graph LR
    A((Участник)) --> B[Включить/выключить камеру]
    A --> C[Включить/выключить микрофон]
    A --> D[Выбрать устройство ввода]
    A --> E[Демонстрировать экран]
    A --> F[Остановить демонстрацию]
    A --> G[Отправить сообщение в чат]
    A --> H[Начать запись конференции]
    A --> I[Завершить запись конференции]
    A --> J[Работать на интерактивной доске]
    
    
    style B fill:#e6f7ff
    style C fill:#e6f7ff
    style D fill:#e6f7ff
    style E fill:#e6f7ff
    style F fill:#e6f7ff
    style G fill:#e6f7ff
    style H fill:#e6f7ff
    style I fill:#e6f7ff
    style J fill:#e6f7ff
```

##### 3. Работа с интерактивной доской
```mermaid
graph LR
    A((Участник)) --> B[Работать на интерактивной доске]
    A --> C[Добавлять аннотации]
    A --> D[Совместно редактировать]
    
    style B fill:#f8f8f8
    style C fill:#f8f8f8
    style D fill:#f8f8f8
```

## Диаграммы последовательностей (Sequence Diagrams)

##### 1. Регистрация

```mermaid
sequenceDiagram
    participant U as Пользователь
    participant F as Frontend
    participant B as Backend
    participant D as База данных
    
    U->>F: Заполняет форму регистрации
    F->>F: Валидация формы
    F->>B: POST /api/register
    B->>D: Проверка уникальности email
    alt Email уже занят
        D-->>B: Email занят
        B-->>F: HTTP 409 - Conflict
        F-->>U: Ошибка "Email уже используется"
    else Email свободен
        D-->>B: Email свободен
        B->>D: Сохранение пользователя
        D-->>B: Успешное сохранение
        B-->>F: HTTP 201 - Created
        F-->>U: Успешная регистрация
    end
```

##### 2.  Вход
```mermaid
sequenceDiagram
    participant U as Пользователь
    participant F as Frontend
    participant B as Backend
    participant D as База данных
    
    U->>F: Вводит учетные данные
    F->>B: POST /api/login
    B->>D: Поиск пользователя
    alt Пользователь не найден
        D-->>B: Пользователь не существует
        B-->>F: HTTP 404 - Not Found
        F-->>U: Ошибка "Неверный email или пароль"
    else Неверный пароль
        D-->>B: Данные пользователя
        B->>B: Проверка пароля
        B-->>F: HTTP 401 - Unauthorized
        F-->>U: Ошибка "Неверный email или пароль"
    else Успешный вход
        D-->>B: Данные пользователя
        B->>B: Проверка пароля - OK
        B->>B: Генерация JWT
        B-->>F: HTTP 200 + JWT
        F-->>U: Успешный вход
    end
```

##### 3. Создание и проведение конференции

```mermaid
sequenceDiagram
    participant O as Организатор
    participant P as Участник
    participant F as Frontend
    participant B as Backend
    participant W as WebRTC сервер
    
    %% Создание комнаты
    O->>F: Создает конференцию
    F->>B: POST /api/rooms
    alt Ошибка авторизации
        B-->>F: 401 Unauthorized
        F-->>O: "Требуется вход в систему"
    else Успех
	    B->>B: Генерация ID комнаты
        B-->>F: Данные комнаты
        F-->>O: Ссылка приглашения
    end
    
    %% Присоединение участника
    P->>F: Переходит по ссылке
    F->>B: GET /api/rooms/{id}
    alt Комната не существует
        B-->>F: 404 Not Found
        F-->>P: "Комната не найдена"
    else Успех
        B-->>F: Данные комнаты
        F->>W: WebRTC подключение
        W-->>F: Установка медиапотока
        F-->>P: Успешное присоединение
    end
```

##### 4. Взаимодействие в конференции
```mermaid

sequenceDiagram
    participant U1 as Пользователь 1
    participant U2 as Пользователь 2
    participant F1 as Frontend U1
    participant F2 as Frontend U2
    participant W as WebRTC сервер
    participant B as Backend
    
    U1->>F1: Включает демонстрацию экрана
    F1->>W: Отправка видеопотока
    W->>F2: Трансляция потока U2
    F2-->>U2: Отображение экрана U1
    
    U1->>F1: Отправляет сообщение в чат
    F1->>B: POST /api/chat/message
    B->>B: Сохранение сообщения
    B->>F2: WebSocket сообщение
    F2-->>U2: Отображение нового сообщения
    
    U2->>F2: Выключает микрофон
    F2->>W: Остановка аудиопотока
    W->>F1: Обновление статуса U2
    F1-->>U1: Отображение "микрофон выключен"
```

##### 5. Работа с интерактивной доской


```mermaid
sequenceDiagram
    participant U as Участник
    participant F as Frontend
    participant B as Backend
    participant W as WebRTC/WebSocket
    participant O as Другие участники

    U->>F: Открывает доску Excalidraw
    F->>B: GET /api/room/{id}/whiteboard
    B-->>F: Состояние доски
    F-->>U: Отображение интерфейса доски
    
    U->>F: Рисует элемент на доске
    F->>W: Отправка данных элемента
    W->>O: Трансляция изменений
    F->>B: POST /api/whiteboard/element
    B->>B: Сохранение элемента
    B-->>F: Подтверждение
    
    U->>F: Выбирает инструмент "текст"
    F->>F: Изменение курсора
    U->>F: Добавляет текстовую заметку
    F->>W: Отправка текстового элемента
    W->>O: Обновление доски у всех
    
    U->>F: Нажимает "Очистить доску"
    F->>B: DELETE /api/whiteboard/clear
    B->>B: Очистка данных доски
    B->>W: Рассылка команды очистки
    W->>O: Очистка доски у всех участников
```


##### 6. Добавление  пользователя в контакты

```mermaid
sequenceDiagram
    participant U1 as Пользователь 1
    participant F1 as Frontend U1
    participant B as Backend
    participant DB as База данных

    U1->>F1: Нажимает "Добавить в контакты" 
    F1->>B: POST /api/contacts/add
    B->>DB: Проверка существования контакта
    DB-->>B: Результат проверки
    B->>B: Создание запроса на добавление
    B->>F1: Push-уведомление о добавлении контакта
    F1-->>U1: Отображение нового контакта в списке контактов
    

     U1->>F1: Открывает список контактов
    F1->>B: GET /api/contacts
    B->>DB: Получение списка контактов
    DB-->>B: Данные контактов
    B-->>F1: Список контактов
    F1-->>U1: Отображение контактов
```
```mermaid
sequenceDiagram
    participant U as Пользователь
    participant F as Frontend
    participant B as Backend
    participant DB as База данных

    %% Добавление контакта
    U->>F: Добавляет контакт
    F->>B: POST /api/contacts/add
    B->>DB: Проверка существования пользователя
    alt Пользователь не найден
        DB-->>B: Пользователь не существует
        B-->>F: 404 - Not Found
        F-->>U: "Пользователь не существует"
    else Пользователь найден
        B->>DB: Проверка существования контакта
        alt Контакт уже есть
            DB-->>B: Контакт существует
            B-->>F: 409 - Conflict
            F-->>U: "Контакт уже добавлен"
        else Можно добавить
            DB-->>B: Можно добавить
            B->>DB: Создание записи контакта
            DB-->>B: Успешное сохранение
            B-->>F: 201 - Created
            F-->>U: "Контакт добавлен"
        end
    end

    %% Просмотр контактов
    U->>F: Открывает список контактов
    F->>B: GET /api/contacts
    B->>DB: Получение списка контактов
    DB-->>B: Данные контактов
    B-->>F: Список контактов
    F-->>U: Отображение контактов
```

##### 7. Запись конференции любым участником

```mermaid
sequenceDiagram
    participant U as Участник
    participant F as Frontend
    participant B as Backend
    participant M as Media Server
   
    U->>F: Нажимает "Начать запись"
    F->>B: POST /api/room/{id}/record/request
    
    F->>M: Инициализация записи
    M-->>F: Подтверждение
    F-->>U: Индикатор записи активен
    
    U->>F: Останавливает запись
    F->>M: Команда остановки
    M->>M: Финализация видеофайла
    M->>B: Уведомление о завершении
    B->>B: Сохранение метаданных записи
    B-->>U: Файл записи
```
